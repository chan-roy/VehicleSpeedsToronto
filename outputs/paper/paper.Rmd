---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - Roy Chan
thanks: "Code and data are available at: https://github.com/chan-roy/sta304_paper1"
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
output:
  bookdown::pdf_document2
toc: FALSE
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
library(tidyverse)
```

# Introduction

You can and should cross-reference sections and sub-sections. For instance, Section \@ref(data). R Markdown automatically makes the sections lower case and adds a dash to spaces to generate labels, for instance, Section \@ref(first-discussion-point). 



# Data

As part of the City of Toronto's Vision Zero Road Safety Plan, the Mobile Watch Your Speed Program uses speed display signs which contain a radar device to detect the speeds of oncoming vehicles and an LED display to show the speed of the vehicle to the driver. The aim of the device is to "remind [motorists] to check their speeds and to obey speed limits" [@citeWYSP]. We note that this program is distinct from automated speed enforcement.

## TODO ADD CITATIONS
Our data is a summary of speeds recorded by the speed display signs. The data is obtained from (CITATION). The dataset as retrieved from `opendatatoronto` consists of 6517 rows each corresponding to an installation of the display, with columns indicating the location, period of installation, and a summary of speed observations made over the period of time it was installed. All displays are scheduled to be on only on weekdays between the hours of 7 AM to 9 PM, but speeds are still recorded by the device. For each row, we have speed distributed by percentiles, as well as the total count of vehicles recorded travelling at a specific speed in bins of 5 km/h increments from 0 to 100 and over.

```{r data, fig.cap="Preview of data", echo = FALSE, message = FALSE}
speed_data <- read_csv(here::here("inputs/data/speed_data.csv"))
print(as_tibble(speed_data), n = 3)
```

- It would be very difficult to operate on all 6000 observations, so devise an appropriate method of summarisation
- We note that the city rotates displays throughout each ward thus will investigate vehicle speed observations on a per ward basis

## Data issues
- Inconsistent operating period. City site specifies 2-3 weeks, but some cameras have operated for months if not years
- Criteria of how locations where displays are deployed are unknown (online form for requests)
- Speed limit of road is not specified. As stated by the City of Toronto (https://www.toronto.ca/311/knowledgebase/kb/docs/articles/transportation-services/district-transportation-services/traffic-operations/minimum-speed-limit-on-streets.html) the default speed limit is 50 km/h unless otherwise posted; thus we will use this as a consideration of whether we consider a vehicle to be speeding. 

Some displays are located on roads which are more busy than others. Thus we will plot a graph of the density of speeds recorded in each ward.

```{r histograms, fig.cap="Histogram of vehicle speed distributions", echo = FALSE}
# drop column schedule as all displays operate on same schedule
locations <- speed_data %>% select(c('_id':removal_date, min_speed))
speed_counts <- left_join(locations, select(speed_data, c('_id', starts_with('spd_'), -spd_00)))

# convert speed_counts to long format 
speed_counts <- speed_counts %>% gather("speed", "count", starts_with('spd_')) %>% 
  mutate(speed = str_remove_all(speed, "spd_")) %>%
  mutate(speed = str_remove_all(speed, "_.*")) %>%
  transform(speed = as.numeric(speed)) %>%
  group_by(ward_no, speed) %>% summarise(count = sum(count))

speed_density <- speed_counts %>% summarise(speed, density = count / sum(count))

ggplot(speed_density, aes(x = speed, y = density, color = as.factor(ward_no), group = ward_no)) + 
  geom_freqpoly(stat = 'identity', position = 'identity') +
  scale_x_continuous(breaks = seq(5, 100, 5)) +
  labs(title = 'Frequency polygons of vehicle speed observations per ward', x = 'Recorded speed (km/h)', y = 'Density', color = 'Ward') +
  theme(text = element_text(size = 10), plot.title = element_text(face = 'bold'), legend.key.size = unit(0.25, 'cm'))
```
Some immediate observations that we can make from this histogram are that it is right-skewed, which indicates a trend of speed limit compliance with  our assumption that the speed limit is 50 km/h. 



# Model

\begin{equation}
Pr(\theta | y) = \frac{Pr(y | \theta) Pr(\theta)}{Pr(y)}  (\#eq:bayes)
\end{equation}

Equation \@ref(eq:bayes) seems useful, eh?

Here's a dumb example of how to use some references: In paper we run our analysis in `R` [@citeR]. We also use the `tidyverse` which was written by @thereferencecanbewhatever If we were interested in baseball data then @citeLahman could be useful. 

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

# Discussion

## First discussion point

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional details


\newpage


# References


